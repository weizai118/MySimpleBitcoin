<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/pb.css"/>
    <style>
        body {
            margin: 20px;
        }

        #result {
            font-size: 18px;
            padding: 15px;
        }
    </style>
</head>

<body>
<div class="form-group">
    <label>付款方公钥</label>
    <textarea type="text" class="form-control" id="senderPublickey">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjA5ykNC321SPiai1Qyz/mvatZM/64dvl
t7NbeEHsXKvdjv3SIREJpRYF1tbs6YcaDpvofqnIdFang7Ci1Zg57NxfwGsYeLvSVHDI+5RLK4gW
YaWm6+yv0Q86W4HuEFX96+AP1WqBSQnHQDf7R2Qmi02qkqZo+LS5SwbgiwGAc0SLmGAspTens0mS
LltvEezKzlRTUf41wsQLpciBjXgRhWCdVNznKUyfoA8t0IbHC+LUcPEP0PVL8KagK/nnuxSCrqhv
BzPog7siYMA78JIQmj7ZiN55RQIGlZ+cXYBEiL8DR43TK7NVj6GD+bnN9fNglHJYXl/MkDEUy4a7
2rrXtwIDAQAB</textarea>
</div>
<div class="form-group">
    <label>付款方私钥</label>
    <textarea type="text" class="form-control" id="senderPrivatekey">-----BEGIN PRIVATE KEY-----
MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCMDnKQ0LfbVI+JqLVDLP+a9q1k
z/rh2+W3s1t4Qexcq92O/dIhEQmlFgXW1uzphxoOm+h+qch0VqeDsKLVmDns3F/Aaxh4u9JUcMj7
lEsriBZhpabr7K/RDzpbge4QVf3r4A/VaoFJCcdAN/tHZCaLTaqSpmj4tLlLBuCLAYBzRIuYYCyl
N6ezSZIuW28R7MrOVFNR/jXCxAulyIGNeBGFYJ1U3OcpTJ+gDy3QhscL4tRw8Q/Q9UvwpqAr+ee7
FIKuqG8HM+iDuyJgwDvwkhCaPtmI3nlFAgaVn5xdgESIvwNHjdMrs1WPoYP5uc3182CUclheX8yQ
MRTLhrvaute3AgMBAAECggEAfkqo1BzhLU3bAO64RJLXCg1V3YoNWIzJYBTDbnVDhW0UpFQMnvSW
Fd799PRpPUsuG+5Kf6zprL5W31DwBFr4ILW3QfNQZc43oxzwnqrh/acBR5vwIN2UzJdGsC1BVkm0
ZnXs0Szw18ORgD76vy139DVcklCsZ1fPne/dmnsIMOdQjYLT/PG06yZIn81Ib0kW+e+Lt13TaaRe
FgUwHr6jpoixXf3DxaJXkQjc1UDSZEJN7KpV1aFfQTLDhgkI38oHs/Gx1Uo+4b86xOJEjyTJuBXq
yrwH1B1rsZxFW8y8+8kPM7fgMghWsZOS4M8MBFxFOdW4983WCTaXLaRYrN4rAQKBgQDFhsih047n
jCkBt5n8uuiWjScv2LVgaCWUvVeglv1QS8Fz73qqnBuuK9uySv8POCy0rbdbx4Ma8PEAIwMOLf3k
kL3Y/3h1mfv6yNMc9s4hlo2LYih4+xt5Kms8PMDEyqxj2mu3Zz5z0liXxAoY4RWsyLvs4PikJ3NY
5tC4MwyI5wKBgQC1hGQSh+M9sEeazKz217hirgkbZ1xm1wh6DSB8ceSd7GP4d9ventbIIUTI6lpj
53HX5EA+CP+85FKpze0dyMCjvWURcVgtcjpnlZUf3t3r6LKTN31CToWNdSafKnomZfysQ0X+nSeq
j0Cnx+O0TehejS5rbmb+cgseMVGoyHhQsQKBgQCNs6ak6SdAlv0n/TXb555JutNc8MMVeUFUlgyR
6R+qhd4vNKK0WC9HYLFIE6MsoOj5aRH8JoG4RxctOPDNMFNOsENxs7wP6bqp633/7lJsKBw83Nsa
B1JrNvIdEZxc0OSg8aWKuedEoabqoTl5Jagt/wdJ5Q6afK60HUmoiv64CwKBgQCDn7v9YAJdQk26
J78ow+bVz8OU1o+/lyBzeL9c3i3cgoU/sJKETQQMXWuGkcH3/eWkmsQm99mSfLKgpU3TMjbWxUjb
rCg31EQbxvE7Ch48qiGL9UnkYhIgMJpQArpOy9e8ho/kAMu5t2U4BQ/OOExO++t0RbtzuPjs7PB9
BtmQEQKBgQCU4jhMq1SgDcNdab/bqrChwHbb5fieJ5IXgxR/NvXpaP7lZT4eeaouEeabWUdZwaGm
c3soWt4GXZwdu3nyrerIFN/wddToaDN0Mb5Dw+UdReIeJZvXov/1WkceHhjWc4pSUYrxX7gBXzyO
zp2sC45e/ZdPM/BImBmgUYxcuWAtEA==
-----END PRIVATE KEY-----</textarea>
</div>
<div class="form-group">
    <label>收款方公钥</label>
    <textarea type="text" class="form-control" id="receiverPublickey">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAngpa5kYcuxmThTdUQHDBdGqXy5e0x2tf
O0FXe4Im351u12VzogaoN3rq3KSbath2BqopZX3IKsLdCzF3qCDe2K7mdb8PuLSdu4ZERtE+QhEx
ia0UMo7k5ro3I6DpJFvDMptWBP1CQLETUwVyakTfSK9fY8oGZAxpyLW8PkF2CNsUPxrq2C6Q1Ox7
h7KeQ2TlC2Wy+usZziGHR+7SQoeUqlOcff90cUzaV2zrL2Jma7vAk+OBX3eMgKP/+W/f8eUc7zEB
pq3ln+b2rwrfNSWk8/6wbNmBdiv1mt2OCS/3kL0dL7ehaIaBM95Du5adHCwSEFbG9TzWTicg9HMF
TqlTMwIDAQAB</textarea>
</div>
<div class="form-group">
    <label>请输入内容</label>
    <input type="text" class="form-control" id="inputContent">
</div>


<div class="btn-group btn-group-lg">
    <button type="button" class="btn btn-default" onclick="addGenesis()">添加封面</button>
    <button type="button" class="btn btn-default" onclick="addNote()">添加记录</button>
    <button type="button" class="btn btn-default" onclick="showList()">展示数据</button>
    <button type="button" class="btn btn-default" onclick="verify()">校验数据</button>
</div>


<div class="btn-group btn-group-lg">
    <button type="button" class="btn btn-default" onclick="register()">注册节点</button>
    <button type="button" class="btn btn-default" onclick="connect()">连接</button>
    <!--<button type="button" class="btn btn-default" onclick="broadcast()">广播</button>-->
    <button type="button" class="btn btn-default" onclick="syncData()">数据同步</button>
</div>

<p class="bg-success" id="result">sucess</p>


<div class="bs-example" data-example-id="simple-table">
    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>记录</th>
            <th>当前区块hash值</th>
            <th>工作量证明</th>
            <th>上一个区块hash值</th>
        </tr>
        </thead>
        <tbody id="Tbody">

        </tbody>
    </table>
</div>



<script src="js/jquery-1.12.4.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
<script src="js/pb.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jsrsasign-all-min.js" type="text/javascript" charset="utf-8"></script>


<script type="text/javascript">

    function addGenesis() {
        //展示进度条
        loading.baosight.showPageLoadingMsg(false);
        var genesis = $("#inputContent").val();
        $.post("addGenesis",
            "genesis="+genesis,
            function (data) {
                $("#result").html(data);
                //清空输入框
                $("#inputContent").val("");
                //执行完函数后隐藏进度条
                loading.baosight.hidePageLoadingMsg();
                showList()
            });
    }
    function addNote() {
        loading.baosight.showPageLoadingMsg(false);
        var content = $("#inputContent").val();//获取交易内容
        var senderPublickey = $("#senderPublickey").val();//获取发送者公钥
        var senderPrivatekey = $("#senderPrivatekey").val();//获取发送者私钥
        var receiverPublickey = $("#receiverPublickey").val();//获取接受者公钥

        //生成发送者私钥
        var prvKey = KEYUTIL.getKey(senderPrivatekey);
        //指定数字签名的算法
        var sig = new KJUR.crypto.Signature({"alg": "SHA256withRSA"});
        ///初始化私钥
        sig.init(prvKey);
        //指定原文
        sig.updateString(content);
        //生成签名
        var sigValueHex = sig.sign();

        $.post("addNote",
            {
                senderPubKey:senderPublickey,
                receiverPubKey:receiverPublickey,
                senderSign:sigValueHex,
                content:content
            },
            function (data) {
                $("#result").html(data);
                //清空输入框
                $("#inputContent").val("");
                loading.baosight.hidePageLoadingMsg();
                showList();
            })
    }
    /*function addNote() {
        loading.baosight.showPageLoadingMsg(false);
        var content = $("#inputContent").val();
        $.post("addNote",
            "content="+content,
            function (data) {
                $("#result").html(data);
                //清空输入框
                $("#inputContent").val("");
                loading.baosight.hidePageLoadingMsg();
                showList();
            })
    }*/
    function showList() {
        loading.baosight.showPageLoadingMsg(false);
        $.get("showList",
            function (data) {
                $("#Tbody").html("");
                for (var i = 0; i < data.length; i++) {
                    var block = data[i];
                    var id = block.id;
                    var content = block.content;
                    var hash = block.hash;
                    var nonce = block.nonce;
                    var preHash = block.preHash;

                    $("#Tbody").append("<tr><td>"+id+"</td><td>"+content+"</td><td>"+hash+"</td><td>"+nonce+"</td><td>"+preHash+"</td></tr>")
                }
                // $("#result").html(data);
                loading.baosight.hidePageLoadingMsg()
            })
    }
    function verify() {
        loading.baosight.showPageLoadingMsg(false);
        $.get("verify",
            function (data) {
                $("#result").html(data);
                loading.baosight.hidePageLoadingMsg()
            })
    }

    function register() {
        loading.baosight.showPageLoadingMsg(false) // 显示进度条
        // 1.获取输入的内容
        var port = $("#inputContent").val();
        // 2. 发起请求
        $.post("register", // 请求路径
            "port=" + port,// 传递的数据
            function (data) { // 请求成功的回调函数
                // 展示操作结果
                $("#result").html(data)
                // 清空输入框
                $("#inputContent").val("");
                loading.baosight.hidePageLoadingMsg() // 隐藏进度条
            });
    }

    function connect() {
        loading.baosight.showPageLoadingMsg(false) // 显示进度条
        $.post("connect", // 请求路径
            function (data) { // 请求成功的回调函数
                // 展示操作结果
                $("#result").html(data)
                loading.baosight.hidePageLoadingMsg() // 隐藏进度条
            });
    }

    function broadcast() {
        loading.baosight.showPageLoadingMsg(false) // 显示进度条
        // 1.获取输入的内容
        var msg = $("#inputContent").val();
        // 2. 发起请求
        $.post("broadcast", // 请求路径
            "msg=" + msg,// 传递的数据
            function (data) { // 请求成功的回调函数
                // 展示操作结果
                $("#result").html(data)
                // 清空输入框
                $("#inputContent").val("");
                loading.baosight.hidePageLoadingMsg() // 隐藏进度条
            });
    }

    function syncData() {
        loading.baosight.showPageLoadingMsg(false); // 显示进度条
        // 2. 发起请求
        $.post("syncData", // 请求路径
            function (data) { // 请求成功的回调函数
                // 展示操作结果
                $("#result").html(data);
                loading.baosight.hidePageLoadingMsg() // 隐藏进度条
            });
    }

    //入口函数
    //作用:一进入页面就显示加载的数据
    $(function () {
        showList();
    })

</script>
</body>

</html>